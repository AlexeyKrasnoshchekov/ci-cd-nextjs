# Используем официальный PHP образ с PHP-FPM
FROM php:7.4-fpm

# Устанавливаем Nginx и необходимые утилиты
RUN apt-get update && apt-get install -y nginx supervisor

# Копируем конфигурацию Nginx
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Копируем конфигурацию Supervisor, чтобы запускать nginx и php-fpm вместе
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# Копируем ваш код в контейнер (путь /var/www/html — корень веб-сервера)
COPY /app/index.php /usr/share/nginx/html/index.php
COPY /app/index.html /usr/share/nginx/html/index.html

# Задаём права
RUN chown -R www-data:www-data /usr/share/nginx/html/

# Открываем необходимый порт
EXPOSE 8889

# Запуск supervisor, который контролирует процессы Nginx и PHP-FPM
CMD ["/usr/bin/supervisord"]
